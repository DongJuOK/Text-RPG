#include "game.h"

char key = 0;
char name[100];

struct Weapon
{
	int health;
	int damage;
	int defense;
};

struct Zombie
{
	int health;
	int attack;
	int defense;
};

struct Weapon shovel = { 100, 15, 10 };
struct Weapon lighter = { 75, 17, 7 };
struct Weapon gun = { 50, 20, 5 };

struct Zombie zombie1 = { 100, 8, 5 };
struct Zombie zombie2 = { 80, 10, 3 };
struct Zombie zombie3 = { 65, 13, 7 };

void Load(const char* fileName)
{
	FILE* file = fopen(fileName, "r");

	char buffer[SIZE2] = { 0, };

	fread(buffer, 1, SIZE2, file);

	printf("%s", buffer);

	fclose(file);
}

void title()
{
	const char title[HEIGHT1][WIDTH] =
	{
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' },
		{ '0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0' },
		{ '0','0','1','1','1','0','1','1','1','0','1','0','1','0','1','1','1','0','0','0','0','0','1','1','1','0','0','1','1','1','0','0','0','1','1','0','0','0' },
		{ '0','0','0','1','0','0','1','0','0','0','1','0','1','0','0','1','0','0','0','0','0','0','1','0','0','1','0','1','0','0','1','0','1','0','0','1','0','0' },
		{ '0','0','0','1','0','0','1','1','1','0','0','1','0','0','0','1','0','0','1','1','1','0','1','1','1','0','0','1','1','1','0','0','1','0','0','0','0','0' },
		{ '0','0','0','1','0','0','1','0','0','0','1','0','1','0','0','1','0','0','0','0','0','0','1','0','0','1','0','1','0','0','0','0','1','0','1','1','0','0' },
		{ '0','0','0','1','0','0','1','1','1','0','1','0','1','0','0','1','0','0','0','0','0','0','1','0','0','1','0','1','0','0','0','0','0','1','1','0','0','0' },
		{ '0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0' },
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' }
	};

	for (int i = 0; i < HEIGHT1; i++)
	{
		for (int j = 0; j < WIDTH; j++)
		{
			if (title[i][j] == '1')
			{
				printf("■");
			}
			else if (title[i][j] == '0')
			{
				printf("  ");
			}
			else
			{
				printf("〓");
			}
		}

		printf("\n");
	}
}

void t_box()
{
	gotoxy(0, 8);

	const char title[HEIGHT1][WIDTH] =
	{
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' }
	};

	for (int i = 0; i < HEIGHT1; i++)
	{
		for (int j = 0; j < WIDTH; j++)
		{
			if (title[i][j] == '1')
			{
				printf("｜");
			}
			else if (title[i][j] == '0')
			{
				printf("  ");
			}
			else
			{
				printf("--");
			}
		}

		printf("\n");
	}
}

int menu()
{
	int x = 32;
	int y = 14;

	gotoxy(x - 2, y);
	printf("> 게 임 시 작");
	gotoxy(x, y + 2);
	printf("게 임 정 보");
	gotoxy(x, y + 4);
	printf("   종 료   ");

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case UP: if (y > 14)
			{
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, y -= 2);
				printf(">");
			}
				   break;

			case DOWN: if (y < 18)
			{
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, y += 2);
				printf(">");
			}
					 break;

			case SUBMIT: return y - 14;
			}
		}
	}

	return 0;
}

void info()
{
	system("cls");

	gotoxy(32, 5);
	printf("[ 조 작 법 ]");

	gotoxy(29, 8);
	printf("이 동 : W, A, S, D");

	gotoxy(27, 11);
	printf("선 택 : 스 페 이 스 바");

	gotoxy(29, 16);
	printf("※ 주 의 사 항 ※");

	gotoxy(19, 18);
	printf("CapsLock이 꺼진 상태로 플레이 해주세요.");

	gotoxy(17, 22);
	printf("스페이스바를 누르면 메인화면으로 이동합니다.");

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case SUBMIT: return;
			}
		}
	}
}

void w_box()
{
	gotoxy(0, 5);

	const char title[HEIGHT2][WIDTH] =
	{
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' }
	};

	for (int i = 0; i < HEIGHT2; i++)
	{
		for (int j = 0; j < WIDTH; j++)
		{
			if (title[i][j] == '1')
			{
				printf("｜");
			}
			else if (title[i][j] == '0')
			{
				printf("  ");
			}
			else
			{
				printf("--");
			}
		}

		printf("\n");
	}
}

void c_box()
{
	system("cls");

	const char title[HEIGHT2][WIDTH] =
	{
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1' },
		{ '2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2' }
	};

	gotoxy(0, 2);

	for (int i = 0; i < HEIGHT2; i++)
	{
		for (int j = 0; j < WIDTH; j++)
		{
			if (title[i][j] == '1')
			{
				printf("｜");
			}
			else if (title[i][j] == '0')
			{
				printf("  ");
			}
			else
			{
				printf("--");
			}
		}

		printf("\n");
	}
}

void public_data()
{
	gotoxy(15, 20);
	printf("모험 시작");
	gotoxy(52, 20);
	printf("게임 종료");
}

void adventure_1()
{
	system("cls");

	Load("zombie_1.txt");


}

int game_select()
{
	int x = 13;
	int y = 20;

	gotoxy(x, y);
	printf(">");

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case RIGHT: if (x < 50)
			{
				gotoxy(x, y);
				printf("  ");
				x += 37;
				gotoxy(x, y);
				printf(">");
			}
					  break;
			
			case LEFT: if (x > 13)
			{
				gotoxy(x, y);
				printf("  ");
				x -= 37;
				gotoxy(x, y);
				printf(">");
			}
					 break;

			case SUBMIT: 
			{
				if (x == 13)
				{
					adventure_1();
				}
				else if (x == 50)
				{
					system("cls");
					exit(0);
				}
			}

			return 0;
			}
		}
	}

	return 0;
}

void data_shovel()
{
	gotoxy(12, 7);
	printf("닉네임 : %s", name);
	gotoxy(14, 11);
	printf("무기 : 삽");
	gotoxy(51, 6);
	printf("체  력 : %d", shovel.health);
	gotoxy(51, 9);
	printf("공격력 : %d", shovel.damage);
	gotoxy(51, 12);
	printf("방어력 : %d", shovel.defense);

	public_data();
	game_select();
}

void data_lighter()
{
	gotoxy(12, 7);
	printf("닉네임 : %s", name);
	gotoxy(7, 11);
	printf("무기 : 라이터와 에프킬라");
	gotoxy(51, 6);
	printf("체  력 : %d", lighter.health);
	gotoxy(51, 9);
	printf("공격력 : %d", lighter.damage);
	gotoxy(51, 12);
	printf("방어력 : %d", lighter.defense);

	public_data();
	game_select();
}

void data_gun()
{
	gotoxy(12, 7);
	printf("닉네임 : %s", name);
	gotoxy(14, 11);
	printf("무기 : 총");
	gotoxy(51, 6);
	printf("체  력 : %d", gun.health);
	gotoxy(51, 9);
	printf("공격력 : %d", gun.damage);
	gotoxy(51, 12);
	printf("방어력 : %d", gun.defense);

	public_data();
	game_select();
}

int weapon_select()
{
	int x = 12;
	int y = 4;

	gotoxy(x, y);
	printf("↓");

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case RIGHT: if (x < 62)
			{
				gotoxy(x, y);
				printf("  ");
				x += 25;
				gotoxy(x, y);
				printf("↓");
			}
					  break;

			case LEFT: if (x > 12)
			{
				gotoxy(x, y);
				printf("  ");
				x -= 25;
				gotoxy(x, y);
				printf("↓");
			}
					 break;

			case SUBMIT:
			{
				if (x == 12)
				{
					c_box();
					data_shovel();
				}
				else if (x == 37)
				{
					c_box();
					data_lighter();
				}
				else if (x == 62)
				{
					c_box();
					data_gun();
				}
			}

			return 0;
			}
		}
	}

	return 0;
}

void weapon_name()
{
	gotoxy(28, 2);
	printf("무기를 선택해주세요.");

	gotoxy(12, 7);
	printf("삽");
	gotoxy(7, 9);
	printf("(근거리 무기)");
	gotoxy(7, 12);
	printf("체  력 : %d", shovel.health);
	gotoxy(7, 14);
	printf("공격력 : %d", shovel.damage);
	gotoxy(7, 16);
	printf("방어력 : %d", shovel.defense);

	gotoxy(30, 7);
	printf("라이터와 에프킬라");
	gotoxy(32, 9);
	printf("(중거리 무기)");
	gotoxy(33, 12);
	printf("체  력 : %d", lighter.health);
	gotoxy(33, 14);
	printf("공격력 : %d", lighter.damage);
	gotoxy(33, 16);
	printf("방어력 : %d", lighter.defense);

	gotoxy(62, 7);
	printf("총");
	gotoxy(57, 9);
	printf("(원거리 무기)");
	gotoxy(58, 12);
	printf("체  력 : %d", gun.health);
	gotoxy(58, 14);
	printf("공격력 : %d", gun.damage);
	gotoxy(58, 16);
	printf("방어력 : %d", gun.defense);

	gotoxy(30, 22);
	printf("선택 : 스페이스");

	weapon_select();
}

void weapon()
{
	system("cls");

	w_box();
	weapon_name();
}

void story()
{
	system("cls");

	const char* story[SIZE];

	gotoxy(0, 5);
	story[0] = "                      때는 2950년 좀비 바이러스 창궐.\n\n\n";

	story[1] = "                당신은 이 바이러스를 끝낼 유일한 희망이다.\n\n\n";

	story[2] = "                   부산에 있는 한 선박에 치료제가 있다.\n\n\n";

	story[3] = "                 좀비들을 물리치며 치료제를 찾도록 하자.\n\n\n\n\n";

	story[4] = "                             다음 : 스페이스";

	for (int i = 0; i < SIZE; i++)
	{
		printf("%s", story[i]);
		Sleep(1000);
	}

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case SUBMIT: weapon();
			}
		}
	}
}

void start()
{
	system("cls");
	t_box();

	gotoxy(22, 12);
	printf("닉네임을 입력하세요: ");
	scanf_s("%s", &name, 100);
	int length = strlen(name);

	system("cls");
	t_box();

	gotoxy(30 - length/2, 12);
	printf("반갑습니다 %s님.", name);
	gotoxy(18, 20);
	printf("스페이스바를 누르면 게임을 시작합니다.");

	while (1)
	{
		if (_kbhit())
		{
			key = _getch();

			if (key == -32)
			{
				key = _getch();
			}

			switch (key)
			{
			case SUBMIT: story();
			}

			break;
		}
	}
}
